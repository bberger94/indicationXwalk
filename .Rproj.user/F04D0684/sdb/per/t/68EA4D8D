{
    "collab_server" : "",
    "contents" : "rm(list = ls())\n\nlibrary(rio)\nlibrary(dplyr)\n\n#load approvals\ndata <- import('data/dh_drugapproval_20062017_BAB_06152017.xlsx')\ndata$indication <- tolower(data$indication)\nnrow(data)\n\n#load xwalk: cortellis indication -> cortellis indication ID\nIDxwalk <- import('data/cortellisInd2IndID.csv')\ncolnames(IDxwalk) <- c('indicationID', 'indication')\nIDxwalk$indication <- tolower(IDxwalk$indication)\n\n#merge in indication IDs\nmerged <- data %>% left_join(IDxwalk, by = 'indication')\ntally.nomatch <- sum(is.na(merged$indicationID))\ncat(tally.nomatch, \"IDs did NOT match\")\n\nexport(merged, \"data/drugApproval_tempfile.Rdata\")\n\n\n####################keep working on this on the 'morrow\ncount.na <- function(x) count <- sum(is.na(x) == FALSE) \nblankstring.2.na <- function(x){\n  x[x == \"\"] <- NA\n  return(x)\n}\n\n\nindMapping <- import('data/indication_mappings.csv')\ncolnames(indMapping)[colnames(indMapping)=='ciIndication'] <- 'indicationID'\nindMapping <- indMapping %>% mutate_each(funs(blankstring.2.na))\n\n#indicate which cortellis IDs correspond to multiple rows in mapping\nduplicatedIDs <- unique(indMapping$indicationID[duplicated(indMapping$indicationID)])\nindMapping$duplicated <- 0\nindMapping$duplicated[is.element(indMapping$indicationID, duplicatedIDs)] <- 1\n\n\n\nmerged <- data %>% left_join(IDxwalk, by = 'indication') %>%  \n                   left_join(indMapping, by = 'indicationID') %>% \n                   arrange(brandname)\n\n\n##SUMMARY STATS\ntestdata <- merged[, c('drugname','brandname','indication', colnames(indMapping))] \n\n#number of drugs which correpond to multiple rows in mapping\nlength(unique(testdata$drugname[testdata$duplicated == 1]))\n#total number of drugs\nlength(unique(testdata$drugname))\n#percent of drugs that map to multiple entries \nlength(unique(testdata$drugname[testdata$duplicated == 1])) / length(unique(testdata$drugname))\n\ngrouped <- testdata %>% group_by(drugname) %>% summarize(count = n())\npie(table(grouped$count))\n\n\n\n\nsum(duplicated(testdata$drugname))/length(unique(testdata$drugname)) \n\n\napply(testdata, 2, count.na)\n\n\n\n\n\n",
    "created" : 1501252732058.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "43015408",
    "id" : "68EA4D8D",
    "lastKnownWriteTime" : 1501252860,
    "last_content_update" : 1501252860640,
    "path" : "C:/Users/bergerb/Dropbox/bkthruWork_local/indicationXwalk/source/mergeIndIDs.R",
    "project_path" : "source/mergeIndIDs.R",
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}